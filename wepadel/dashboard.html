<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard CafÃ©Misu Ã— We Padel</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">

<style>
    body {
        background-color: #F9F5F1;
        font-family: 'Playfair Display', serif;
        color: #A87555;
        margin: 20px;
        padding: 0;
    }

    h1 {
        text-align: center;
        font-size: 2.4rem;
        margin-bottom: 25px;
    }

    .order {
        background: white;
        padding: 18px;
        margin: 15px 0;
        border-radius: 14px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .order-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
    }

    .order-items {
        margin-bottom: 12px;
        padding-left: 20px;
    }

    .status {
        font-weight: bold;
        padding: 6px 12px;
        border-radius: 8px;
        font-size: 0.9rem;
        color: white;
    }

    .pending { background-color: #D4A373; }
    .preparing { background-color: #6C757D; }
    .served { background-color: #7CB518; }
    .paid { background-color: #495057; }

    button {
        padding: 10px 16px;
        border: none;
        margin-right: 8px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
    }

    .btn-prep { background-color: #6C757D; color:white; }
    .btn-serv { background-color: #7CB518; color:white; }
    .btn-paid { background-color: #495057; color:white; }
</style>
</head>

<body>

<h1>ðŸ“‹ Commandes â€“ CafÃ©Misu Ã— We Padel</h1>

<div id="orders"></div>

<script type="module">
    // ----------------------------------------------------------------
    // Firebase
    // ----------------------------------------------------------------
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, onSnapshot, doc, updateDoc } 
            from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDb7QI70lVF5vhQahUau5z2E7QOvdte9Y",
      authDomain: "cafemisu-wepadel.firebaseapp.com",
      projectId: "cafemisu-wepadel",
      storageBucket: "cafemisu-wepadel.appspot.com",
      messagingSenderId: "184586399626",
      appId: "1:184586399626:web:382a3671ca9b32baba4273"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ----------------------------------------------------------------
    // RÃ©ception des commandes en temps rÃ©el
    // ----------------------------------------------------------------
    const ordersDiv = document.getElementById("orders");

    onSnapshot(collection(db, "orders"), (snapshot) => {
        ordersDiv.innerHTML = "";
        snapshot.forEach((docu) => {
            const data = docu.data();
            const id = docu.id;

            let statusClass = "pending";
            if (data.status === "preparing") statusClass = "preparing";
            if (data.status === "served") statusClass = "served";
            if (data.status === "paid") statusClass = "paid";

            ordersDiv.innerHTML += `
                <div class="order">
                    <div class="order-header">
                        <div>
                            <strong>Table ${data.table}</strong><br>
                            <span class="status ${statusClass}">${data.status}</span>
                        </div>
                        <div>
                            <button class="btn-prep" onclick="updateStatus('${id}', 'preparing')">PrÃ©parer</button>
                            <button class="btn-serv" onclick="updateStatus('${id}', 'served')">Servi</button>
                            <button class="btn-paid" onclick="updateStatus('${id}', 'paid')">PayÃ©</button>
                        </div>
                    </div>

                    <div class="order-items">
                        ${data.items.map(i => `<li>${i.name} â€” ${i.price} FCFA</li>`).join("")}
                    </div>

                    <em>Client : ${data.name}</em><br>
                    <small>ReÃ§u : ${data.createdAt?.toDate ? data.createdAt.toDate().toLocaleString() : "â€”"}</small>
                </div>
            `;
        });
    });

    // ----------------------------------------------------------------
    // Mise Ã  jour du statut commande
    // ----------------------------------------------------------------
    window.updateStatus = async function(id, newStatus) {
        await updateDoc(doc(db, "orders", id), { status: newStatus });
    };
</script>

</body>
</html>
